---
title: "R Notebook"
output:
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
---

## 1.1 Load the dataset from the given files into two dataframes. Rename columns to remove spaces if exist in the column names (Hint: use str_replace_all to do this automatically for all columns). Make sure date values are in the correct type. Show a summary of each dataframe (including statistics of each column).

```{r}
# Load necessary packages
library(tidyverse)
library(lubridate)

# Load Show.csv into a dataframe
shows_df <- read.csv("show.csv")

# Rename columns to remove spaces
colnames(shows_df) <- str_replace_all(colnames(shows_df), " ", "")

# Convert date columns to correct type
shows_df$Date.Added <- mdy(shows_df$Date.Added)

# Check for missing values and replace with appropriate technique
summary(shows_df)

```

```{r}
# Load MaturityType.csv into a dataframe
maturity_df <- read.csv("MaturityType.csv")

# Rename columns to remove spaces
colnames(maturity_df) <- str_replace_all(colnames(maturity_df), " ", "")

# Check for missing values and replace with appropriate technique
summary(maturity_df)

```

## 1.2 Write R code to investigate whether there are duplicate rows in the show dataframe; if yes, how many of them, display them and then remove them (Hint: check the duplicated() function). Display the number of rows before and after removal. Modify the IMDB score column to remove the "/10" and change its type to numeric

```{r}
# Check for duplicate rows and display them
duplicated_rows <- shows_df[duplicated(shows_df), ]
print(paste("Number of duplicate rows: ", nrow(duplicated_rows)))
print("Duplicate rows:")
print(duplicated_rows)

# Remove duplicate rows
shows_df <- shows_df[!duplicated(shows_df), ]

# Display number of rows before and after removal
print(paste("Number of rows before removal: ", nrow(shows_df) + nrow(duplicated_rows)))
print(paste("Number of rows after removal: ", nrow(shows_df)))

# Modify Imdb.Score column to remove "/10" and change type to numeric
shows_df$Imdb.Score <- as.numeric(gsub("/10", "", shows_df$Imdb.Score))

# Check data types of columns
str(shows_df)
```

## 1.3 Choose a production country and a year of your interest and write the R code to display the TV shows that this country produced as "TV Show for Mature Audiences" in this year. Your result should not be empty.

```{r}
# Select production country and year of interest
production_country <- "United States"
year_of_interest <- 2020

# Filter shows produced by selected country in selected year
selected_shows <- shows_df %>% 
  filter(Production.Country == production_country, 
         year(Date.Added) == year_of_interest, 
         Rating == "TV-MA" & grepl("TV Show", Content.Type))

# Display selected shows
if (nrow(selected_shows) > 0) {
  print(paste("Selected shows produced by", production_country, "in", year_of_interest, "rated TV-MA and classified as TV Show:"))
  print(selected_shows$Title)
} else {
  print(paste("No TV shows produced by", production_country, "in", year_of_interest, "rated TV-MA and classified as TV Show were found."))
}

```

## 1.4 Display titles that have both "teen" and "high school" in the description. Display the title, release year, the IMDB score in ascending order of release year and descending order of the IMDB score.Only show the top 5 rows.

```{r}
# Select shows with "teen" and "high school" in the description
selected_shows <- shows_df %>% 
  filter(str_detect(tolower(Description), "teen") & str_detect(tolower(Description), "high school"))

# Display titles, release year, and IMDB score, sorted by release year in ascending order and IMDB score in descending order
top_5_shows <- selected_shows %>% 
  select(Title, Release.Date, Imdb.Score) %>% 
  arrange(Release.Date, desc(Imdb.Score)) %>% 
  top_n(5)

# Print top 5 shows
print(top_5_shows)
```

## 1.5 Find the top three production countries with the highest number of TV shows that are designed to be "TV Show Suitable for General Audiences". For each country, display the number of shows and average IMDB score.

```{r}
# Select TV shows suitable for general audiences
general_audience_shows <- shows_df %>% 
  filter(Rating == "TV-G" & grepl("TV Show", Content.Type))

# Group shows by production country
country_groups <- general_audience_shows %>% 
  group_by(Production.Country)

# Summarize shows by count and average IMDB score
country_summary <- country_groups %>% 
  summarize(num_shows = n(), avg_imdb_score = mean(as.numeric(gsub("/10", "", Imdb.Score), na.rm = TRUE)))

# Sort countries by number of shows and select top three
top_countries <- country_summary %>% 
  arrange(desc(num_shows)) %>% 
  head(3)

# Print results
print("Top three production countries with the highest number of TV shows suitable for general audiences:")
print(top_countries)

```

## 1.6 Draw boxplot to compare the distribution of the IMDB scores for movies produced after 2010 by United States and by Canada. What are the five values in each boxplot? Write a short paragraph (less than 100 words) to describe your insights.

```{r}
# Select movies produced after 2010 by the United States or Canada
selected_movies <- shows_df %>% 
  filter(Production.Country %in% c("United States", "Canada"), 
         as.numeric(ifelse(Release.Date == "", 0, Release.Date)) > 2010, 
         grepl("Movie", Content.Type))

# Draw boxplot of IMDB scores for US and Canadian movies
ggplot(selected_movies, aes(x = Production.Country, y = as.numeric(gsub("/10", "", Imdb.Score)))) +
  geom_boxplot() +
  ggtitle("Distribution of IMDB Scores for US and Canadian Movies Produced After 2010") +
  ylab("IMDB Score")

# Display five values in each boxplot
by(selected_movies$Imdb.Score, selected_movies$Production.Country, 
   FUN = function(x) {summary(as.numeric(gsub("/10", "", x)))})
```

**Answer: Based on the boxplot and summary statistics, we can see that the distribution of IMDB scores for Canadian movies produced after 2010 is slightly less spread out than that of US movies. The median IMDB score for Canadian movies is slightly higher than that of US movies, while the minimum and maximum scores are also slightly lower for Canadian movies. However, the interquartile range and the upper and lower quartiles are also USA have more than Canada. Overall, the difference in the distribution of IMDB scores between the two countries is relatively small, and it is possible that other factors such as genre, budget, or marketing may have a stronger influence on IMDB scores than the country of production.**

## 1.7 To help a mother choose a good movie for her children who are less than 7 years old, you are required to: a) Propose a ranking with at least 2 criteria to rank the movies that best suit to their children (provide justification). b) Then write R code to find the top 5 movies based on your proposed ranking. (c) Write a short paragraph to discuss your insights and recommendations.

Answer: a) To propose a ranking with at least 2 criteria to rank the movies that best suit to children less than 7 years old, we can consider the following criteria:

Age-appropriateness: This criterion assesses whether a movie is suitable for children under 7 years of age based on its content, language, and themes. For example, movies with excessive violence, profanity, or sexual content may not be appropriate for young children.

Educational value: This criterion assesses the educational value of a movie for young children. For example, movies that teach children about important values such as kindness, empathy, and teamwork, or introduce them to new concepts or cultures can be beneficial for their learning and development.

b)  To find the top 5 movies based on this ranking, we can use the following R code:

```{r}
# Filter movies suitable for children less than 7 years old
selected_movies <- shows_df %>%
  filter(grepl("TV-Y7", Rating)) %>%
  filter(grepl("Movie", Content.Type))

# Rank movies based on age-appropriateness and educational value
ranked_movies <- selected_movies %>%
  mutate(age_rank = ifelse(grepl("TV-Y", Rating) | grepl("TV-G", Rating) | grepl("TV-Y7", Rating), 1, 0),
         edu_rank = ifelse(grepl("Educational", Genres), 1, 0)) %>%
  mutate(rank = age_rank + edu_rank) %>%
  arrange(desc(rank), desc(as.numeric(gsub("/10", "", Imdb.Score)))) %>%
  select(Title, Release.Date, Rating, Genres, Imdb.Score)

# Display top 5 movies
head(ranked_movies, 5)
```

c) Based on the proposed ranking and the top 5 movies, we can see that movies with high age-appropriateness and educational value tend to rank higher in the list. The top 5 movies include "A truthful Mother", "Arlo the Alligator Boy", "Buddy Thunderstruck: The Maybe Pile", "Rocko's Modern Life: Static Cling", and "ego DC Comics: Batman Be-Leaguered". These movies are rated "TV-Y7", and have educational themes such as teamwork, friendship, and creativity. Parents looking for movies suitable for children less than 7 years old can use this ranking to find movies that are not only entertaining but also age-appropriate and educational for their children.
